<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EXCELlent Intermediate Accounting ‚Äì Quizzes</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- üìå Sticky Navigation Tabs -->
  <header id="sticky-header">
    <nav class="tabs">
      <a href="index.html">Home</a>
      <a href="glossary.html">Glossary</a>
      <a href="quizzes.html" class="active">Quizzes</a>
      <a href="references.html">References</a>
      <a href="visuals.html">Visuals</a>
      <a href="tools.html">Tools</a>
    </nav>

    <!-- üîΩ Sticky Filter Controls -->
    <div class="filters">
      <select id="volume"></select>
      <select id="chapter"></select>
      <select id="topic"></select>
      <select id="type"></select>
      <button id="submitBtn">Submit</button>
      <button id="resetBtn">Reset</button>
    </div>
  </header>

  <!-- üìù Quiz Display Section -->
  <main>
    <section id="quizArea">
      <h2>üß† Quiz Questions</h2>
      <div id="questionContainer">Please select filters and click Submit.</div>
      <div id="scoreContainer"></div>
    </section>
  </main>

  <!-- üß† Script Logic -->
  <script>
    // üîÅ START REPLACEABLE BLOCK: Question Bank
    const questions = [
      {
        volume: "Volume 1",
        chapter: "Chapter 1",
        topic: "Cash and Cash Equivalents",
        type: "Theory",
        question: "Which of the following is considered a cash equivalent?",
        choices: ["Inventory", "Accounts Receivable", "Treasury Bills", "Prepaid Rent"],
        correct: 2
      },
      {
        volume: "Volume 1",
        chapter: "Chapter 1",
        topic: "Cash and Cash Equivalents",
        type: "Practice",
        question: "Classify the following item as cash or cash equivalent.",
        imageQuestion: "images/q1.png",
        choices: ["Cash", "Cash Equivalent", "Neither", "Both"],
        correct: 1,
        imageAnswer: "images/a1.png"
      }
      // üîÅ END REPLACEABLE BLOCK: Question Bank
    ];

    // üîß DOM Elements
    const volumeDropdown = document.getElementById("volume");
    const chapterDropdown = document.getElementById("chapter");
    const topicDropdown = document.getElementById("topic");
    const typeDropdown = document.getElementById("type");
    const submitBtn = document.getElementById("submitBtn");
    const resetBtn = document.getElementById("resetBtn");
    const questionContainer = document.getElementById("questionContainer");
    const scoreContainer = document.getElementById("scoreContainer");

    // üß© Utility Functions
    const getUnique = (key, filter = {}) => {
      return [...new Set(
        questions
          .filter(q => Object.entries(filter).every(([k, v]) => q[k] === v))
          .map(q => q[key])
      )];
    };

    const buildDropdown = (dropdown, items) => {
      dropdown.innerHTML = "";
      items.forEach(item => {
        const opt = document.createElement("option");
        opt.value = item;
        opt.textContent = item;
        dropdown.appendChild(opt);
      });
    };

    const adjustDropdownWidth = (dropdown) => {
      const tempSpan = document.createElement("span");
      tempSpan.style.visibility = "hidden";
      tempSpan.style.position = "absolute";
      tempSpan.style.whiteSpace = "nowrap";
      document.body.appendChild(tempSpan);

      let maxWidth = 0;
      Array.from(dropdown.options).forEach(opt => {
        tempSpan.textContent = opt.textContent;
        const width = tempSpan.offsetWidth;
        if (width > maxWidth) maxWidth = width;
      });

      document.body.removeChild(tempSpan);
      dropdown.style.width = `${maxWidth + 40}px`;
    };

    // üöÄ Initial Load
    const initDropdowns = () => {
      const volumes = getUnique("volume");
      buildDropdown(volumeDropdown, volumes);
      volumeDropdown.dispatchEvent(new Event("change"));
    };

    volumeDropdown.addEventListener("change", () => {
      const vol = volumeDropdown.value;
      const chapters = getUnique("chapter", { volume: vol });
      buildDropdown(chapterDropdown, chapters);
      chapterDropdown.dispatchEvent(new Event("change"));
    });

    chapterDropdown.addEventListener("change", () => {
      const vol = volumeDropdown.value;
      const chap = chapterDropdown.value;
      const topics = getUnique("topic", { volume: vol, chapter: chap });
      buildDropdown(topicDropdown, topics);
      adjustDropdownWidth(topicDropdown);
      topicDropdown.dispatchEvent(new Event("change"));
    });

    topicDropdown.addEventListener("change", () => {
      const vol = volumeDropdown.value;
      const chap = chapterDropdown.value;
      const topic = topicDropdown.value;

      const types = getUnique("type", { volume: vol, chapter: chap, topic: topic });
      const typeOptions = [...types];
      if (types.includes("Theory") && types.includes("Practice")) {
        typeOptions.push("Both");
      }
      buildDropdown(typeDropdown, typeOptions);
    });

    // üß† Quiz Renderer
    submitBtn.addEventListener("click", () => {
      const vol = volumeDropdown.value;
      const chap = chapterDropdown.value;
      const topic = topicDropdown.value;
      const type = typeDropdown.value;

      const filtered = questions.filter(q =>
        q.volume === vol &&
        q.chapter === chap &&
        q.topic === topic &&
        (type === "Both" || q.type === type)
      );

      if (filtered.length === 0) {
        questionContainer.innerHTML = "<p>‚ö†Ô∏è No questions found for this selection.</p>";
        scoreContainer.innerHTML = "";
        return;
      }

      questionContainer.innerHTML = "";
      scoreContainer.innerHTML = "";

      let score = 0;

      filtered.forEach((q, index) => {
        const wrapper = document.createElement("div");
        wrapper.className = "question-block";

        const qText = document.createElement("p");
        qText.innerHTML = `<strong>Q${index + 1}:</strong> ${q.question}`;
        wrapper.appendChild(qText);

        if (q.type === "Practice" && q.imageQuestion) {
          const imgQ = document.createElement("img");
          imgQ.src = q.imageQuestion;
          imgQ.alt = "Practice Question Image";
          imgQ.className = "excel-image";
          wrapper.appendChild(imgQ);
        }

        const choiceList = document.createElement("ul");
        q.choices.forEach((choice, i) => {
          const li = document.createElement("li");
          const radio = document.createElement("input");
          radio.type = "radio";
          radio.name = `q${index}`;
          radio.value = i;
          li.appendChild(radio);
          li.appendChild(document.createTextNode(" " + choice));
          choiceList.appendChild(li);
        });
        wrapper.appendChild(choiceList);

        const answerDiv = document.createElement("div");
        answerDiv.className = "answer-block";
        answerDiv.style.display = "none";

        const correctText = document.createElement("p");
        correctText.textContent = `‚úÖ Correct Answer: ${q.choices[q.correct]}`;
        answerDiv.appendChild(correctText);

        if (q.type === "Practice" && q.imageAnswer) {
          const imgA = document.createElement("img");
          imgA.src = q.imageAnswer;
          imgA.alt = "Practice Answer Image";
          imgA.className = "excel-image";
          answerDiv.appendChild(imgA);
        }

        wrapper.appendChild(answerDiv);
        questionContainer.appendChild(wrapper);
      });

      // üßÆ Score Calculation
      const radios = document.querySelectorAll("input[type='radio']:checked");
      radios.forEach(radio => {
        const qIndex = parseInt(radio.name.replace("q", ""));
        if (parseInt(radio.value) === filtered[qIndex].correct) score++;
      });

      const percentage = ((score / filtered.length) * 100).toFixed(2);
      scoreContainer.innerHTML = `<p>üéØ Raw Score: ${score} / ${filtered.length}</p><p>üìä Percentage: ${percentage}%</p>`;

      // Reveal answers
      document.querySelectorAll(".answer-block").forEach(div => {
        div.style.display = "block";
      });
    });

    // üîÅ Reset Logic
    resetBtn.addEventListener("click", () => {
      questionContainer.innerHTML = "Please select filters and click Submit.";
      scoreContainer.innerHTML = "";
      initDropdowns();
    });

    // üß≠ Initialize on Load
    initDropdowns();
  </script>
</body>
</html>
