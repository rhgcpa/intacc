<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EXCELlent Intermediate Accounting ‚Äì Quizzes Hub</title>
  <style>
    /* Basic styling for clarity */
    .hidden { display: none; }
    .quiz-block { margin-bottom: 20px; }
    .correct { color: green; }
    .incorrect { color: red; }
    .excel-image { max-width: 100%; height: auto; }
    .celebration-banner { background: #f0f8ff; padding: 20px; border: 2px solid #00f; margin-bottom: 20px; }
    .progress-tracker { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>EXCELlent Intermediate Accounting ‚Äì Quizzes Hub</h1>
  </header>

  <main>
    <nav>
      <select id="volumeSelect">
        <option value="">Select Volume</option>
        <option value="vol1">Volume 1</option>
        <option value="vol2">Volume 2</option>
      </select>

      <select id="chapterSelect" disabled>
        <option value="">Select Chapter</option>
      </select>

      <select id="topicSelect" disabled>
        <option value="">Select Topic</option>
      </select>

      <select id="typeSelect" disabled>
        <option value="">Select Type</option>
      </select>

      <button id="submitBtn" disabled>Submit</button>
      <button id="resetBtn">Reset</button>
    </nav>

    <section id="scoreDisplay" class="hidden">
      <p>Raw Score: <span id="rawScore">0</span></p>
      <p>Percentage: <span id="percentageScore">0%</span></p>
    </section>

    <section id="quizContainer"></section>
  </main>

  <footer>
    <p>&copy; 2025 EXCELlent Intermediate Accounting</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const volumeSelect = document.getElementById("volumeSelect");
      const chapterSelect = document.getElementById("chapterSelect");
      const topicSelect = document.getElementById("topicSelect");
      const typeSelect = document.getElementById("typeSelect");
      const submitBtn = document.getElementById("submitBtn");
      const resetBtn = document.getElementById("resetBtn");
      const quizContainer = document.getElementById("quizContainer");
      const scoreDisplay = document.getElementById("scoreDisplay");
      const rawScore = document.getElementById("rawScore");
      const percentageScore = document.getElementById("percentageScore");

      let score = 0;
      let totalQuestions = 0;

      function adjustDropdownWidth(selectElement) {
        const temp = document.createElement("select");
        const option = document.createElement("option");
        option.textContent = selectElement.options[selectElement.selectedIndex]?.text || "";
        temp.style.visibility = "hidden";
        temp.style.position = "absolute";
        temp.style.font = getComputedStyle(selectElement).font;
        temp.appendChild(option);
        document.body.appendChild(temp);
        selectElement.style.width = `${temp.offsetWidth + 24}px`;
        document.body.removeChild(temp);
      }

      [volumeSelect, chapterSelect, topicSelect, typeSelect].forEach(select => {
        select.addEventListener("change", () => adjustDropdownWidth(select));
      });

      volumeSelect.addEventListener("change", () => {
        const vol = volumeSelect.value;
        chapterSelect.innerHTML = `<option value="">Select Chapter</option>`;
        topicSelect.innerHTML = `<option value="">Select Topic</option>`;
        typeSelect.innerHTML = `<option value="">Select Type</option>`;
        chapterSelect.disabled = true;
        topicSelect.disabled = true;
        typeSelect.disabled = true;
        submitBtn.disabled = true;

        if (vol && quizData[vol]) {
          chapterSelect.disabled = false;
          const chapters = quizData[vol].chapters;
          for (let chap in chapters) {
            const option = document.createElement("option");
            option.value = chap;
            option.textContent = chap.replace("chap", "Chapter ");
            chapterSelect.appendChild(option);
          }
        }
      });

      chapterSelect.addEventListener("change", () => {
        const vol = volumeSelect.value;
        const chap = chapterSelect.value;
        topicSelect.innerHTML = `<option value="">Select Topic</option>`;
        typeSelect.innerHTML = `<option value="">Select Type</option>`;
        topicSelect.disabled = true;
        typeSelect.disabled = true;
        submitBtn.disabled = true;

        if (chap && quizData[vol]?.chapters?.[chap]) {
          topicSelect.disabled = false;
          const topics = quizData[vol].chapters[chap].topics;
          for (let topic in topics) {
            const option = document.createElement("option");
            option.value = topic;
            option.textContent = topic;
            topicSelect.appendChild(option);
          }
        }
      });

      topicSelect.addEventListener("change", () => {
        const vol = volumeSelect.value;
        const chap = chapterSelect.value;
        const topic = topicSelect.value;
        typeSelect.innerHTML = `<option value="">Select Type</option>`;
        typeSelect.disabled = true;
        submitBtn.disabled = true;

        if (topic && quizData[vol]?.chapters?.[chap]?.topics?.[topic]) {
          typeSelect.disabled = false;
          const types = quizData[vol].chapters[chap].topics[topic].types;
          types.forEach(type => {
            const option = document.createElement("option");
            option.value = type;
            option.textContent = type;
            typeSelect.appendChild(option);
          });
          adjustDropdownWidth(typeSelect);
        }
      });

      typeSelect.addEventListener("change", () => {
        submitBtn.disabled = !typeSelect.value;
      });

      submitBtn.addEventListener("click", () => {
        const volume = volumeSelect.value;
        const chapter = chapterSelect.value;
        const topic = topicSelect.value;
        const type = typeSelect.value;
        const normalizeTopic = str => str.replace(/\s+/g, "").replace(/[^a-zA-Z0-9]/g, "");
        const key = `${normalizeTopic(topic)}_${chapter}_${volume}`;

        quizContainer.innerHTML = "";
        scoreDisplay.classList.remove("hidden");
        score = 0;
        totalQuestions = 0;

        const renderBlock = (q, index, mode) => {
          const block = document.createElement("div");
          block.className = "quiz-block";
          const questionHTML = `
            <p>${q.question}</p>
            ${mode === "Practice" && q.imageQ ? `<img src="${q.imageQ}" alt="Practice Question Image" class="excel-image" /><br/>` : ""}
            ${q.choices.map((choice, i) => `
              <label><input type="radio" name="${mode.toLowerCase()}${index}" value="${i}"> ${choice}</label><br/>
            `).join("")}
            <button onclick="check${mode}('${key}', ${index}${mode === "Practice" && q.imageA ? `, '${q.imageA}'` : ""})">Reveal Answer</button>
            <div id="feedback-${mode.toLowerCase()}${index}" class="feedback"></div>
            ${mode === "Practice" && q.imageA ? `<img id="answer-img-${index}" src="${q.imageA}" alt="Answer Image" style="display:none;">` : ""}
          `;
          block.innerHTML = questionHTML;
          quizContainer.appendChild(block);
        };

        if (type === "Theory" || type === "Both") {
          const theoryQs = questions[key]?.Theory || [];
          theoryQs.forEach((q, index) => {
            totalQuestions++;
            renderBlock(q, index, "Theory");
          });
        }

        if (type === "Practice" || type === "Both") {
          const practiceQs = questions[key]?.Practice || [];
          practiceQs.forEach((q, index) => {
            totalQuestions++;
            renderBlock(q, index, "Practice");
          });
        }
      });

      resetBtn.addEventListener("click", () => {
        volumeSelect.value = "";
        chapterSelect.innerHTML = `<option value="">Select Chapter</option>`;
        topicSelect.innerHTML = `<option value="">Select Topic</option>`;
        typeSelect.innerHTML = `<option value="">Select Type</option>`;
        chapterSelect.disabled = true;
        topicSelect.disabled = true;
        typeSelect.disabled = true;
        submitBtn.disabled = true;
        quizContainer.innerHTML = "";
        scoreDisplay.classList.add("hidden");
        rawScore.textContent = "0";
        percentageScore.textContent = "0%";
        score = 0;
        totalQuestions = 0;
      });

      window.checkTheory = function(key, index) {
        const selected = document.querySelector(`input[name="theory${index}"]:checked`);
        const feedback = document.getElementById(`feedback-theory${index}`);
        if (selected && feedback.innerHTML === "") {
          const q = safeGetQuestion(key, "Theory", index);
          if (!q) return;

          const userAnswer = parseInt(selected.value);
          const correctText = q.choices[q.answer];
          feedback.innerHTML = userAnswer === q.answer
            ? `<p class="correct">‚úÖ Correct!</p>`
            : `<p class="incorrect">‚ùå Incorrect. Correct answer: ${correctText}</p>`;
          score++;
          updateScore();
          updateProgressTracker();
          selected.closest(".quiz-block").scrollIntoView({ behavior: "smooth" });
        }
      };

      window.checkPractice = function(key, index, imagePath) {
        const selected = document.querySelector(`input[name="practice${index}"]:checked`);
        const feedback = document.getElementById(`feedback-practice${index}`);
        if (selected && feedback.innerHTML === "") {
          const q = safeGetQuestion(key, "Practice", index);
          if (!q) return;

          const userAnswer = parseInt(selected.value);
          const correctText = q.choices[q.answer];
          feedback.innerHTML = userAnswer === q.answer
            ? `<p class="correct">‚úÖ Correct!</p>`
            : `<p class="incorrect">‚ùå Incorrect. Correct answer: ${correctText}</p>`;
          const answerImage = document.createElement("img");
          answerImage.src = imagePath;
          answerImage.alt = "Practice Answer Image";
          answerImage.className = "excel-image";
          feedback.appendChild(answerImage);
          score++;
          updateScore();
          updateProgressTracker();
          selected.closest(".quiz-block").scrollIntoView({ behavior: "smooth" });
        }
      };

      function updateProgressTracker() {
        const tracker = document.getElementById("progressTracker");
        if (!tracker) {
          const newTracker = document.createElement("div");
          newTracker.id = "progressTracker";
          newTracker.className = "progress-tracker";
          scoreDisplay.insertAdjacentElement("beforebegin", newTracker);
        }
        const answered = document.querySelectorAll(".feedback p").length;
        document.getElementById("progressTracker").innerHTML = `
          <p>Progress: ${answered} of ${totalQuestions} questions answered</p>
        `;
      }

      function exportFeedbackLog() {
        const logs = [];
        for (let i = 0; i < totalQuestions; i++) {
          const theoryFeedback = document.getElementById(`feedback-theory${i}`);
          const practiceFeedback = document.getElementById(`feedback-practice${i}`);
          if (theoryFeedback && theoryFeedback.innerText) {
            logs.push(`Theory ${i + 1}: ${theoryFeedback.innerText}`);
          }
          if (practiceFeedback && practiceFeedback.innerText) {
            logs.push(`Practice ${i + 1}: ${practiceFeedback.innerText}`);
          }
        }
        console.log("üì§ Feedback Log Export:");
        logs.forEach(log => console.log(log));
      }

      function safeGetQuestion(key, type, index) {
        try {
          return questions[key]?.[type]?.[index] || null;
        } catch (e) {
          console.warn(`‚ö†Ô∏è Failed to access ${type} question at index ${index} in block ${key}`);
          return null;
        }
      }

      function updateScore() {
        rawScore.textContent = score;
        const percentage = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
        percentageScore.textContent = `${percentage}%`;
        celebrateIfPerfect();
      }

      function celebrateIfPerfect() {
        if (score === totalQuestions && totalQuestions > 0) {
          const banner = document.createElement("div");
          banner.className = "celebration-banner";
          banner.innerHTML = `
            <h2>üéâ Perfect Score Celebration üéâ</h2>
            <p>You answered all ${totalQuestions} questions correctly. This is summit-grade mastery.</p>
          `;
          quizContainer.prepend(banner);
        }
      }

      console.log("‚úÖ DOMContentLoaded block closed successfully");
    }); // ‚úÖ Close DOMContentLoaded listener
  </script>
</body>
</html>
