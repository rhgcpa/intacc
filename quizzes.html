<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quizzes</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- üîí Sticky Navigation Tabs -->
  <header class="sticky-header">
    <nav class="tab-bar">
      <a href="index.html">Home</a>
      <a href="glossary.html">Glossary</a>
      <a href="quizzes.html" class="active">Quizzes</a>
      <a href="references.html">References</a>
      <a href="visuals.html">Visuals</a>
      <a href="tools.html">Tools</a>
    </nav>

    <!-- üîß Dropdown Controls -->
    <div class="dropdown-controls">
      <select id="volumeSelect">
        <option value="">Select Volume</option>
        <option value="vol1">Volume 1</option>
        <option value="vol2">Volume 2</option>
        <option value="vol3">Volume 3</option>
      </select>

      <select id="chapterSelect" disabled>
        <option value="">Select Chapter</option>
      </select>

      <select id="topicSelect" disabled>
        <option value="">Select Topic</option>
      </select>

      <select id="typeSelect" disabled>
        <option value="">Select Type</option>
      </select>

      <button id="submitBtn" disabled>Submit</button>
      <button id="resetBtn">Reset</button>
    </div>
  </header>

  <!-- üì¶ Quiz Display Area -->
  <main id="quizContainer"></main>

  <!-- üìä Score Display -->
  <footer id="scoreDisplay" class="hidden">
    <p>Raw Score: <span id="rawScore">0</span></p>
    <p>Percentage: <span id="percentageScore">0%</span></p>
  </footer>

  <script>
    // üìÅ REPLACEABLE BLOCK: Volumes, Chapters, Topics, Types
    const quizData = {
      vol1: {
        chapters: {
          chap1: {
            topics: {
              topic1: { types: ['Theory', 'Practice'] },
              topic2: { types: ['Theory'] }
            }
          },
          chap2: {
            topics: {
              topic3: { types: ['Practice'] }
            }
          }
        }
      },
      vol2: {
        chapters: {
          chap1: {
            topics: {
              topic1: { types: ['Theory', 'Both'] }
            }
          }
        }
      },
      vol3: {
        chapters: {
          chap3: {
            topics: {
              topic2: { types: ['Practice', 'Both'] }
            }
          }
        }
      }
    };

    // üìÅ REPLACEABLE BLOCK: Questions per Topic and Type
    const questions = {
      topic1: {
        Theory: [
          {
            question: "What is the capital of France?",
            choices: ["Berlin", "Madrid", "Paris", "Rome"],
            answer: 2
          }
        ],
        Practice: [
          {
            question: "Identify the correct Excel formula for summing A1:A10.",
            imageQ: "practice_q_topic1.png",
            choices: ["=SUM(A1:A10)", "=TOTAL(A1:A10)", "=ADD(A1:A10)", "=AGGREGATE(A1:A10)"],
            answer: 0,
            imageA: "practice_a_topic1.png"
          }
        ]
      },
      topic2: {
        Practice: [
          {
            question: "Which Excel function returns the current date?",
            imageQ: "practice_q_topic2.png",
            choices: ["=TODAY()", "=NOW()", "=DATE()", "=CURRENT()"],
            answer: 0,
            imageA: "practice_a_topic2.png"
          }
        ]
      }
    };

    // üîó DOM Elements
    const volumeSelect = document.getElementById("volumeSelect");
    const chapterSelect = document.getElementById("chapterSelect");
    const topicSelect = document.getElementById("topicSelect");
    const typeSelect = document.getElementById("typeSelect");
    const submitBtn = document.getElementById("submitBtn");
    const resetBtn = document.getElementById("resetBtn");
    const quizContainer = document.getElementById("quizContainer");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const rawScore = document.getElementById("rawScore");
    const percentageScore = document.getElementById("percentageScore");

    let score = 0;
    let totalQuestions = 0;

    // üîÑ Dropdown Logic
    volumeSelect.addEventListener("change", () => {
      const vol = volumeSelect.value;
      chapterSelect.innerHTML = `<option value="">Select Chapter</option>`;
      topicSelect.innerHTML = `<option value="">Select Topic</option>`;
      typeSelect.innerHTML = `<option value="">Select Type</option>`;
      chapterSelect.disabled = true;
      topicSelect.disabled = true;
      typeSelect.disabled = true;
      submitBtn.disabled = true;

      if (vol && quizData[vol]) {
        chapterSelect.disabled = false;
        for (let chap in quizData[vol].chapters) {
          const option = document.createElement("option");
          option.value = chap;
          option.textContent = chap.replace("chap", "Chapter ");
          chapterSelect.appendChild(option);
        }
      }
    });

    chapterSelect.addEventListener("change", () => {
      const vol = volumeSelect.value;
      const chap = chapterSelect.value;
      topicSelect.innerHTML = `<option value="">Select Topic</option>`;
      typeSelect.innerHTML = `<option value="">Select Type</option>`;
      topicSelect.disabled = true;
      typeSelect.disabled = true;
      submitBtn.disabled = true;

      if (chap && quizData[vol].chapters[chap]) {
        topicSelect.disabled = false;
        for (let topic in quizData[vol].chapters[chap].topics) {
          const option = document.createElement("option");
          option.value = topic;
          option.textContent = topic.replace("topic", "Topic ");
          topicSelect.appendChild(option);
        }
      }
    });

    topicSelect.addEventListener("change", () => {
      const vol = volumeSelect.value;
      const chap = chapterSelect.value;
      const topic = topicSelect.value;
      typeSelect.innerHTML = `<option value="">Select Type</option>`;
      typeSelect.disabled = true;
      submitBtn.disabled = true;

      if (topic && quizData[vol].chapters[chap].topics[topic]) {
        typeSelect.disabled = false;
        quizData[vol].chapters[chap].topics[topic].types.forEach(type => {
          const option = document.createElement("option");
          option.value = type;
          option.textContent = type;
          typeSelect.appendChild(option);
        });
      }
    });

    typeSelect.addEventListener("change", () => {
      submitBtn.disabled = !typeSelect.value;
    });

    // üöÄ Submit Logic (continued)
    submitBtn.addEventListener("click", () => {
      const topic = topicSelect.value;
      const type = typeSelect.value;
      quizContainer.innerHTML = "";
      scoreDisplay.classList.remove("hidden");
      score = 0;
      totalQuestions = 0;

      // Render Theory Questions
      if (type === "Theory" || type === "Both") {
        const theoryQs = questions[topic]?.Theory || [];
        theoryQs.forEach((q, index) => {
          totalQuestions++;
          const block = document.createElement("div");
          block.className = "quiz-block";
          block.innerHTML = `
            <p>${q.question}</p>
            ${q.choices.map((choice, i) => `
              <label><input type="radio" name="theory${index}" value="${i}"> ${choice}</label><br/>
            `).join("")}
            <button onclick="checkTheory('${topic}', ${index})">Reveal Answer</button>
            <div id="feedback-theory${index}" class="feedback"></div>
          `;
          quizContainer.appendChild(block);
        });
      }

      // Render Practice Questions
      if (type === "Practice" || type === "Both") {
        const practiceQs = questions[topic]?.Practice || [];
        practiceQs.forEach((q, index) => {
          totalQuestions++;
          const block = document.createElement("div");
          block.className = "quiz-block";
          block.innerHTML = `
            <p>${q.question}</p>
            <img src="${q.imageQ}" alt="Practice Question Image" class="excel-image" />
            ${q.choices.map((choice, i) => `
              <label><input type="radio" name="practice${index}" value="${i}"> ${choice}</label><br/>
            `).join("")}
            <button onclick="checkPractice('${topic}', ${index}, '${q.imageA}')">Reveal Answer</button>
            <div id="feedback-practice${index}" class="feedback"></div>
          `;
          quizContainer.appendChild(block);
        });
      }
    });

    // ‚úÖ Reset Logic
    resetBtn.addEventListener("click", () => {
      volumeSelect.value = "";
      chapterSelect.innerHTML = `<option value="">Select Chapter</option>`;
      topicSelect.innerHTML = `<option value="">Select Topic</option>`;
      typeSelect.innerHTML = `<option value="">Select Type</option>`;
      chapterSelect.disabled = true;
      topicSelect.disabled = true;
      typeSelect.disabled = true;
      submitBtn.disabled = true;
      quizContainer.innerHTML = "";
      scoreDisplay.classList.add("hidden");
      rawScore.textContent = "0";
      percentageScore.textContent = "0%";
      score = 0;
      totalQuestions = 0;
    });

    // üß† Answer Checkers
    window.checkTheory = function(topic, index) {
      const selected = document.querySelector(`input[name="theory${index}"]:checked`);
      const feedback = document.getElementById(`feedback-theory${index}`);
      if (selected && feedback.innerHTML === "") {
        const q = questions[topic].Theory[index];
        const userAnswer = parseInt(selected.value);
        const correctText = q.choices[q.answer];
        feedback.innerHTML = userAnswer === q.answer
          ? `<p>‚úÖ Correct!</p>`
          : `<p>‚ùå Incorrect. Correct answer: ${correctText}</p>`;
        score++;
        updateScore();
        selected.closest(".quiz-block").scrollIntoView({ behavior: "smooth" });
      }
    };

    window.checkPractice = function(topic, index, imagePath) {
      const selected = document.querySelector(`input[name="practice${index}"]:checked`);
      const feedback = document.getElementById(`feedback-practice${index}`);
      if (selected && feedback.innerHTML === "") {
        const q = questions[topic].Practice[index];
        const userAnswer = parseInt(selected.value);
        const correctText = q.choices[q.answer];
        feedback.innerHTML = userAnswer === q.answer
          ? `<p>‚úÖ Correct!</p>`
          : `<p>‚ùå Incorrect. Correct answer: ${correctText}</p>`;
        const answerImage = document.createElement("img");
        answerImage.src = imagePath;
        answerImage.alt = "Practice Answer Image";
        answerImage.className = "excel-image";
        feedback.appendChild(answerImage);
        score++;
        updateScore();
        selected.closest(".quiz-block").scrollIntoView({ behavior: "smooth" });
      }
    };

    // üìä Score Updater
    function updateScore() {
      rawScore.textContent = score;
      const percentage = totalQuestions > 0 ? Math.round((score / totalQuestions) * 100) : 0;
      percentageScore.textContent = `${percentage}%`;
    }
  </script>
</body>
</html>
