<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Quizzes | EXCELlent Intermediate Accounting</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .sticky-header {
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 1000;
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    .nav-tabs, .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .nav-tabs a {
      text-decoration: none;
      padding: 8px 12px;
      background-color: #eee;
      border-radius: 4px;
    }
    .controls select, .controls button {
      padding: 6px;
      font-size: 1rem;
    }
    .question-block {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .question-image {
      max-width: 100%;
      height: auto;
      margin: 10px 0;
    }
    .score-summary {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header class="sticky-header">
    <nav class="nav-tabs">
      <a href="index.html">Home</a>
      <a href="glossary.html">Glossary</a>
      <a href="quizzes.html">Quizzes</a>
      <a href="references.html">References</a>
      <a href="visuals.html">Visuals</a>
      <a href="tools.html">Tools</a>
    </nav>
    <div class="controls">
      <select id="volumeSelect"></select>
      <select id="chapterSelect"></select>
      <select id="topicSelect"></select>
      <select id="typeSelect"></select>
      <button id="submitBtn">Submit</button>
      <button id="resetBtn">Reset</button>
    </div>
  </header>

  <main id="quizContainer"></main>
  <div class="score-summary" id="scoreSummary"></div>

  <script>
    let quizData = []; // Populated after parsing Word and PNG files

    // Questions start below this line
    quizData.push(
      {
        volume: "Volume 1",
        chapter: "Chapter 1",
        topic: "Cash and Cash Equivalents",
        type: "Theory",
        questions: [
          {
            question: "Q1. Cash on hand includes:",
            choices: [
              "Checks dated less than 6 months after today.",
              "Checks dated less than 6 months before today.",
              "Checks dated more than 6 months after today.",
              "Checks dated more than 6 months before today."
            ],
            correct: "B"
          },
          {
            question: "Q2. In defining cash equivalents, known maturity value denotes:",
            choices: [
              "Maturity date is determinable on acquisition date.",
              "Maturity value is determinable on acquisition date.",
              "Maturity value will be determined on maturity date.",
              "Maturity value will be known on maturity date."
            ],
            correct: "B"
          },
          {
            question: "Q3. Which are excluded from cash equivalents?",
            choices: [
              "Credit cards receivable.",
              "Debit cards receivable.",
              "Time deposits downgraded lower than savings accounts when pre-terminated.",
              "Time deposits downgraded not lower than savings accounts when pre-terminated."
            ],
            correct: "C"
          },
          {
            question: "Q4. Which are classified as restricted cash, and presented as noncurrent assets?",
            choices: [
              "Currency usable for at least 12 months after the reporting period.",
              "Currency usable for less than 12 months after the reporting period.",
              "Currency usable for more than 12 months after the reporting period.",
              "Currency usable within 12 months after the reporting period."
            ],
            correct: "A"
          },
          {
            question: "Q5. Which are classified as short-term investments, and presented as current assets?",
            choices: [
              "Bank deposits withdrawable with insignificant penalty and usable for less than 12 months.",
              "Bank deposits withdrawable with significant penalty and usable for more than 12 months.",
              "Bank deposits withdrawable with significant penalty and usable within 12 months.",
              "Bank deposits withdrawable without penalty and usable for less than 12 months."
            ],
            correct: "C"
          },
          {
            question: "Q6. These describe a bank overdraft, except:",
            choices: [
              "It is allowed only if caused by normal bank charges or other incidental handling fees.",
              "It is disallowed in the Philippines.",
              "It is known as temporary overdrawing in the Philippines.",
              "It is the negative (or overdrawn) balance in a demand deposit account."
            ],
            correct: "B"
          },
          {
            question: "Q7. Check withdrawals are recorded as:",
            choices: [
              "Debit to Demand Deposits of depositor entity and credit to Deposit Liabilities of financial institution.",
              "Debit to Demand Deposits of financial institution and credit to Deposit Liabilities of depositor entity.",
              "Debit to Deposit Liabilities of depositor entity and credit to Demand Deposits of financial institution.",
              "Debit to Deposit Liabilities of financial institution and credit to Demand Deposits of depositor entity."
            ],
            correct: "D"
          },
          {
            question: "Q8. Timing differences for Deposit Liabilities of financial institution comprise:",
            choices: [
              "Credit memos and debit memos.",
              "Outstanding checks and debit memos.",
              "Outstanding deposits and credit memos.",
              "Outstanding deposits and outstanding checks."
            ],
            correct: "D"
          },
          {
            question: "Q9. Which describe debit memos?",
            choices: [
              "They are already credited to Demand Deposits but not yet debited to Deposit Liabilities.",
              "They are already credited to Deposit Liabilities but not yet debited to Demand Deposits.",
              "They are already debited to Demand Deposits but not yet credited to Deposit Liabilities.",
              "They are already debited to Deposit Liabilities but not yet credited to Demand Deposits."
            ],
            correct: "D"
          },
          {
            question: "Q10. Before replenishment, the adjusted balance of Petty Cash Fund equals:",
            choices: [
              "Currency in the custody of the Petty Cash Custodian.",
              "Established amount.",
              "Minimum threshold.",
              "Total of Petty Cash Vouchers."
            ],
            correct: "A"
          }
        ]
      },
      {
        volume: "Volume 1",
        chapter: "Chapter 1",
        topic: "Cash and Cash Equivalents",
        type: "Practice",
        questions: [
          {
            question: "Q1. With these givens, the closing outstanding checks are:",
            image: "images/practice1.png",
            choices: ["289,000.00", "311,000.00", "489,000.00", "511,000.00"],
            correct: "B",
            answerImage: "images/answer1.png"
          },
          {
            question: "Q2. With these givens, the opening outstanding checks are:",
            image: "images/practice2.png",
            choices: ["289,000.00", "311,000.00", "489,000.00", "511,000.00"],
            correct: "B",
            answerImage: "images/answer2.png"
          },
          {
            question: "Q3. With these givens, the closing book balance is:",
            image: "images/practice3.png",
            choices: ["2,496,000.00", "2,499,800.00", "2,500,200.00", "2,504,000.00"],
            correct: "B",
            answerImage: "images/answer3.png"
          },
          {
            question: "Q4. With these givens, the closing outstanding deposits are:",
            image: "images/practice4.png",
            choices: ["487,000.00", "513,000.00", "887,000.00", "913,000.00"],
            correct: "D",
            answerImage: "images/answer4.png"
          },
          {
            question: "Q5. With these givens, the closing outstanding deposits are:",
            image: "images/practice5.png",
            choices: ["398,700.00", "398,900.00", "898,700.00", "898,900.00"],
            correct: "C",
            answerImage: "images/answer5.png"
          }
        ]
      }
    );
    // Questions end above this line

    let currentQuestions = [];

    function populateDropdown(select, options, placeholder) {
      select.innerHTML = "";
      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = placeholder;
      defaultOption.disabled = true;
      defaultOption.selected = true;
      select.appendChild(defaultOption);

      options.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt;
        option.textContent = opt;
        select.appendChild(option);
      });

      select.disabled = options.length === 0;
    }

    function getUniqueValues(key, filter = {}) {
      return [...new Set(quizData
        .filter(q => Object.entries(filter).every(([k, v]) => q[k] === v))
        .map(q => q[key]))];
    }

    function adjustTopicDropdownWidth() {
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      ctx.font = window.getComputedStyle(topicSelect).font;

      const topics = getUniqueValues("topic", {
        volume: volumeSelect.value,
        chapter: chapterSelect.value
      });

      let maxWidth = 0;
      topics.forEach(topic => {
        const width = ctx.measureText(topic).width;
        if (width > maxWidth) maxWidth = width;
      });

      topicSelect.style.width = `${Math.ceil(maxWidth + 40)}px`;
    }

    function updateDropdowns() {
      const selectedVolume = volumeSelect.value;
      const selectedChapter = chapterSelect.value;

      const chapters = getUniqueValues("chapter", { volume: selectedVolume });
      populateDropdown(chapterSelect, chapters, "Select Chapter");

      const topics = getUniqueValues("topic", {
        volume: selectedVolume,
        chapter: chapterSelect.value
      });
      populateDropdown(topicSelect, topics, "Select Topic");
      topicSelect.disabled = topics.length === 0;

      adjustTopicDropdownWidth();

      const topicQuestions = quizData.filter(q =>
        q.volume === selectedVolume &&
        q.chapter === chapterSelect.value &&
        q.topic === topicSelect.value
      );

      const types = ["Theory"];
      if (topicQuestions.some(q => q.type === "Practice")) {
        types.push("Practice", "Both");
      }
      populateDropdown(typeSelect, types, "Select Type");
      typeSelect.disabled = types.length === 0;
    }

    function renderQuestions() {
      quizContainer.innerHTML = "";
      scoreSummary.textContent = "";

      const selectedVolume = volumeSelect.value;
      const selectedChapter = chapterSelect.value;
      const selectedTopic = topicSelect.value;
      const selectedType = typeSelect.value;

      let filtered = quizData.filter(q =>
        q.volume === selectedVolume &&
        q.chapter === selectedChapter &&
        q.topic === selectedTopic &&
        (selectedType === "Both" || q.type === selectedType)
      );

      currentQuestions = shuffleArray(filtered.flatMap(q => q.questions));

      currentQuestions.forEach((q, i) => {
        const block = document.createElement("div");
        block.className = "question-block";

        const qText = document.createElement("p");
        qText.textContent = `Q${i + 1}: ${q.question.replace(/^Q\d+\.\s*/, "")}`;
        block.appendChild(qText);

        if (q.image) {
          const img = document.createElement("img");
          img.src = q.image;
          img.alt = `Question ${i + 1}`;
          img.className = "question-image";
          block.appendChild(img);
        }

        ["A", "B", "C", "D"].forEach((letter, idx) => {
          const label = document.createElement("label");
          const input = document.createElement("input");
          input.type = "radio";
          input.name = `q${i}`;
          input.value = letter;
          label.appendChild(input);
          label.append(` ${letter}. ${q.choices[idx]}`);
          block.appendChild(label);
          block.appendChild(document.createElement("br"));
        });

        quizContainer.appendChild(block);
      });
    }

    function submitAnswers() {
      let score = 0;
      currentQuestions.forEach((q, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        if (selected && selected.value === q.correct) score++;

        if (q.answerImage) {
          const img = document.createElement("img");
          img.src = q.answerImage;
          img.alt = `Answer ${i + 1}`;
          img.className = "question-image";
          quizContainer.children[i].appendChild(img);
        }

        const answer = document.createElement("p");
        answer.textContent = `Correct Answer: ${q.correct}`;
        quizContainer.children[i].appendChild(answer);
      });

      const percentage = ((score / currentQuestions.length) * 100).toFixed(2);
      scoreSummary.textContent = `Score: ${score}/${currentQuestions.length} (${percentage}%)`;
    }

    function resetQuiz() {
      quizContainer.innerHTML = "";
      scoreSummary.textContent = "";
      initializeDropdowns();
    }

    function shuffleArray(arr) {
      return arr.map(v => [Math.random(), v])
                .sort((a, b) => a[0] - b[0])
                .map(v => v[1]);
    }

    function initializeDropdowns() {
      const volumes = getUniqueValues("volume");
      populateDropdown(volumeSelect, volumes, "Select Volume");
    }

    volumeSelect.addEventListener("change", updateDropdowns);
    chapterSelect.addEventListener("change", updateDropdowns);
    topicSelect.addEventListener("change", updateDropdowns);
    typeSelect.addEventListener("change", renderQuestions);
    document.getElementById("submitBtn").addEventListener("click", submitAnswers);
    document.getElementById("resetBtn").addEventListener("click", resetQuiz);

    initializeDropdowns();
  </script>
</body>
</html>
